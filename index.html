<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>מערכת הזנת ציונים לפרויקט רשתות</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <style>
        body {
            direction: rtl;
            background-color: #f8f9fa;
            padding: 20px;
        }
        .form-section {
            background-color: #fff;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        .form-title {
            margin-bottom: 20px;
            border-bottom: 2px solid #dee2e6;
            padding-bottom: 10px;
        }
        input[type="text"], input[type="number"], input[type="date"] {
            font-weight: bold;
            font-size: 1.25rem;
        }
        .mark-display {
            display: inline-block;
            width: 100px;
            height: 100px;
            line-height: 100px;
            text-align: center;
            border-radius: 50%;
            background-color: #d4edda;
            color: #155724;
            font-weight: bold;
            font-size: 32px;
            margin: 10px;
        }
        @media (max-width: 576px) {
            .mark-display {
                width: 70px;
                height: 70px;
                line-height: 70px;
                font-size: 20px;
            }
            input[type="text"], input[type="number"], input[type="date"] {
                font-size: 1.6rem !important;
                height: 3.5rem;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <h2 class="text-center mb-4">הערכת פרויקטים ברשתות תקשורת, 5 יח"ל – סמל שאלון: 794589</h2>

    <div class="form-section">
        <h4 class="form-title">פרטי בית ספר ובחינה</h4>
        <div class="row mb-3">
            <div class="col-md-4">
                <label>שם בית הספר:</label>
                <input type="text" class="form-control" id="schoolName">
            </div>
            <div class="col-md-4">
                <label>סמל בית ספר:</label>
                <input type="text" class="form-control" id="schoolCode" maxlength="6">
            </div>
            <div class="col-md-4">
                <label>תאריך בחינה:</label>
                <input type="date" class="form-control" id="examDate">
            </div>
        </div>
    </div>

    <div class="form-section">
        <h4 class="form-title">פרטי תלמיד</h4>
        <div class="row mb-3">
            <div class="col-md-6">
                <label>שם התלמיד:</label>
                <input type="text" class="form-control" id="studentName">
            </div>
            <div class="col-md-6">
                <label>ת.ז:</label>
                <input type="text" class="form-control" id="studentId" maxlength="9">
            </div>
        </div>
    </div>

    <div class="form-section">
        <h4 class="form-title">חלק הספר (30%)</h4>
        <div class="row">
            <div class="col-md-3"><label>מבוא (2 נק')</label><input type="number" class="form-control" id="b1" max="2" min="0"></div>
            <div class="col-md-3"><label>תוכן עניינים (2 נק')</label><input type="number" class="form-control" id="b2" max="2" min="0"></div>
            <div class="col-md-3"><label>אודות ותרשים (4 נק')</label><input type="number" class="form-control" id="b3" max="4" min="0"></div>
            <div class="col-md-3"><label>דרישות מערכת (6 נק')</label><input type="number" class="form-control" id="b4" max="6" min="0"></div>
            <div class="col-md-3"><label>טופולוגיה (6 נק')</label><input type="number" class="form-control" id="b5" max="6" min="0"></div>
            <div class="col-md-3"><label>תיעוד רכיבים (20 נק')</label><input type="number" class="form-control" id="b6" max="20" min="0"></div>
            <div class="col-md-3"><label>הגדרות CLI וכו' (30 נק')</label><input type="number" class="form-control" id="b7" max="30" min="0"></div>
            <div class="col-md-3"><label>ניתוב/מטרו/צילומים (20 נק')</label><input type="number" class="form-control" id="b8" max="20" min="0"></div>
            <div class="col-md-3"><label>פקודות show ורפלקציה (10 נק')</label><input type="number" class="form-control" id="b9" max="10" min="0"></div>
        </div>
        <div class="mt-3 text-end">
            <strong>סה"כ חלק הספר:</strong> <span id="bookTotalDisplay" class="mark-display">0</span>
        </div>
    </div>

    <div class="form-section">
        <h4 class="form-title">חלק ההצגה (70%)</h4>
        <div class="row">
            <div class="col-md-3"><label>שליטה בפרויקט (5 נק')</label><input type="number" class="form-control" id="p1" max="5" min="0"></div>
            <div class="col-md-3"><label>שאלה רמה א (10 נק')</label><input type="number" class="form-control" id="p2" max="10" min="0"></div>
            <div class="col-md-3"><label>שאלה רמה א (10 נק')</label><input type="number" class="form-control" id="p3" max="10" min="0"></div>
            <div class="col-md-3"><label>שאלה רמה א (10 נק')</label><input type="number" class="form-control" id="p4" max="10" min="0"></div>
            <div class="col-md-3"><label>שאלה רמה ב (15 נק')</label><input type="number" class="form-control" id="p5" max="15" min="0"></div>
            <div class="col-md-3"><label>שאלה רמה ב (15 נק')</label><input type="number" class="form-control" id="p6" max="15" min="0"></div>
            <div class="col-md-3"><label>שאלה רמה ב/ג (15 נק')</label><input type="number" class="form-control" id="p7" max="15" min="0"></div>
            <div class="col-md-3"><label>מטלת ביצוע (20 נק')</label><input type="number" class="form-control" id="p8" max="20" min="0"></div>
        </div>
        <div class="mt-3 text-end">
            <strong>סה"כ חלק ההצגה:</strong> <span id="presentationTotalDisplay" class="mark-display">0</span>
        </div>
    </div>

    <div class="text-center mb-4">
        <button class="btn btn-primary btn-lg" onclick="calculateFinal()">חשב ציון סופי</button>
        <div class="mt-4">
            <span class="fw-bold">הציון הסופי:</span>
            <span id="finalDisplay" class="mark-display">0</span>
        </div>
        <div class="mt-4">
            <button class="btn btn-success" onclick="window.print()">שמור כ-PDF / הדפס</button>
        </div>
    </div>
</div>

<script>
    function sumMarks(ids) {
        return ids.reduce((sum, id) => sum + (parseFloat(document.getElementById(id).value) || 0), 0);
    }

    function clampInputs() {
        document.querySelectorAll("input[type='number']").forEach(input => {
            input.addEventListener("input", () => {
                const val = parseFloat(input.value);
                const max = parseFloat(input.max);
                const min = parseFloat(input.min);
                if (val > max) input.value = max;
                if (val < min) input.value = min;
                updateTotals();
            });
        });
    }

    function updateTotals() {
        const bookIds = ["b1","b2","b3","b4","b5","b6","b7","b8","b9"];
        const presIds = ["p1","p2","p3","p4","p5","p6","p7","p8"];
        document.getElementById("bookTotalDisplay").textContent = sumMarks(bookIds);
        document.getElementById("presentationTotalDisplay").textContent = sumMarks(presIds);
    }

    function calculateFinal() {
        const book = parseFloat(document.getElementById("bookTotalDisplay").textContent) || 0;
        const pres = parseFloat(document.getElementById("presentationTotalDisplay").textContent) || 0;
        const finalMark = Math.round(book * 0.3 + pres * 0.7);
        document.getElementById("finalDisplay").textContent = finalMark;
    }

    document.getElementById("studentId").addEventListener("input", function () {
        const id = this.value;
        if (/^\d{9}$/.test(id)) loadStudentData(id);
    });

    function saveBookMark() {
        const id = document.getElementById("studentId").value;
        const name = document.getElementById("studentName").value;
        const schoolName = document.getElementById("schoolName").value;
        const schoolCode = document.getElementById("schoolCode").value;
        const examDate = document.getElementById("examDate").value;

        const bookIds = ["b1","b2","b3","b4","b5","b6","b7","b8","b9"];
        const bookMarks = {};
        bookIds.forEach(bid => bookMarks[bid] = parseFloat(document.getElementById(bid).value) || 0);
        const bookMark = sumMarks(bookIds);

        const data = JSON.parse(localStorage.getItem("studentsData") || "{}");
        data[id] = {
            studentName: name,
            bookMark: bookMark,
            bookMarks: bookMarks,
            schoolName,
            schoolCode,
            examDate
        };
        localStorage.setItem("studentsData", JSON.stringify(data));
        alert("הנתונים נשמרו בהצלחה");
    }

    function loadStudentData(id) {
        const data = JSON.parse(localStorage.getItem("studentsData") || "{}");
        if (data[id]) {
            const s = data[id];
            document.getElementById("studentName").value = s.studentName;
            document.getElementById("bookTotalDisplay").textContent = s.bookMark;
            Object.keys(s.bookMarks || {}).forEach(key => {
                if (document.getElementById(key)) {
                    document.getElementById(key).value = s.bookMarks[key];
                }
            });
            document.getElementById("schoolName").value = s.schoolName || "";
            document.getElementById("schoolCode").value = s.schoolCode || "";
            document.getElementById("examDate").value = s.examDate || "";
        }
    }

    window.onload = clampInputs;
</script>
</body>
</html>
